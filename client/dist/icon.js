(function(r){function p(t,e,a){for(const[i,c]of Object.entries(t))if(c[e]==a)return i}function g(t,e,a,i,c,n){e.val(t);let d=t.split(",");a.html("");let s=r("<ul>"),l=0;d.forEach((o,f)=>{let u=p(n,"value",o);if(u){let h=n[u];s.append("<li>"+h.template+"</li>"),i.find('li[data-value="'+h.value+'"]').attr("data-selected",!0),l++}}),s.attr("data-count",l),a.html(s)}function m(t,e){clearTimeout(window.iconfilterSelectionTimeout),window.iconfilterSelectionTimeout=setTimeout(()=>{let a=e.children("ul").children("li"),i=e.children("span"),c=t.target.value;if(c=="")e.attr("data-search",!1),i.html(""),a.each((n,d)=>{d.setAttribute("data-display",!0)});else{e.attr("data-search",!0),a.each((s,l)=>{l.getAttribute("data-search-str").search(c)>=0?l.setAttribute("data-display",!0):l.setAttribute("data-display",!1)});let n=e.children("ul").children('li[data-display="true"]'),d=parseInt(n.length);i.html(d+" icon"+(d>1?"s":"")+" found")}},500)}function v(t,e,a,i,c){let n=r("<ul>"),d=r("<span>"),s=[];a&&a.length&&(s=a[0].value.split(","));for(const[l,o]of Object.entries(t)){let f=o.value?o.value:l,u=[f,o.title,o.source];n.append('<li data-value="'+f+'" data-search-str="'+u.join()+'" data-key="'+l+'" data-selected="'+!!s.includes(f.toString())+'"><label>'+o.template+"</label></li>")}e.append(d),e.append(n),e.find("li > label").off("click").on("click",l=>{e.find("li").attr("data-selected",!1),g(r(l.currentTarget).closest("li").attr("data-value"),a,i,e,c,t)})}function b(t,e,a){let i=t.currentTarget.getAttribute("data-value"),c=e.val().replace(","+i,"").replace(i+",","").replace(i,"");e.val(c);let n=c.split(",");n=n>0?n:0,a.find("ul").attr("data-count",n),a.find("ul").html("")}r(document).ready(()=>{}),r(".cms-edit-form").entwine({onmatch(t){this._super(t)},onunmatch(t){this._super(t)},onaftersubmitform(t,e){}}),r.entwine("ss",t=>{t("[data-goldfinch-icon-field]").entwine({onmatch(){const e=JSON.parse(t(this).attr("data-goldfinch-icon-config")),a=JSON.parse(t(this).attr("data-goldfinch-icon-source")),i=t(this).find('[data-goldfinch-icon="key"]');t(this).find('[data-goldfinch-icon="data"]');const c=t(this).find("[data-goldfinch-icon-selected]"),n=t(this).find("[data-goldfinch-icon-loader]")[0],d=t(this).find("[data-goldfinch-icon-loader] button")[0],s=t(this).find("[data-goldfinch-icon-search]"),l=t(this).find("[data-goldfinch-icon-selection]");c.find("li").on("click",o=>{b(o,i,c)}),t(d).on("click",()=>{n.remove(),s.removeClass("goldfinchicon__hide"),s.on("keydown",o=>{m(o,l)}),v(a,l,i,c,e),l.removeClass("goldfinchicon__hide")})}})})})(jQuery);
